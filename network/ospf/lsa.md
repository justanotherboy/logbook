# OSPF Link-State Advertisment (LSA)

LSAs communicate the local router's topology to other routers in order to run the SPF algorithm once the databases are synchronized. There are several types of LSAs that have different flooding scopes.The flooding process starts when a router receives a Link State Update packet from an adjacent neighbor, the router identifies the most recent LSA, install into the Link-State Database and floods the packet to the rest of its interfaces. Flooding occurs before running the SPF algorithm and there might be transient loop while propagating the information. All LSAs contains age, sequence number, and checksum. The age is used to remove outdated information, the sequence number is used to keep track of changes, and the checksum to guarantee the integrity of the LSA.

When a router running OSPF goes down or unreachable, the LSA type 1 will set the flag to not reachable in case the router comes back it won't need to exchange all the LSA with it's neighbors. It needs to run SPF though. By default it wil keep the LSA for the Max Age time (60 minutes).

## LSA types

### LSA 1: Router

- Describes the node (router) and the attributes and links of the node
- Area local scope
- Generated by all routers
- Link-State ID: Router ID
- The links of the node includes:
    - Type of network
    - Link ID : Network/Subnet (stub network), Designated Router IP address (Multi-access) or Neighbor Router ID (Point-to-Point)
    - Link Data: Network Mask (stub network) or Router interface address (Multi-access or Point-to-Point)
    - Cost

### LSA 2: Network

- Describes a Multi-Access (Broadcast or Non-broadcast) segment
- Area local scope
- Used to optimize OSPF operations on a shared segement
    - Calculate the cost to the Designated Router (star topology) instead of a mesh
    - Reduce LSA flooding
    - Reduce OSPF adjacencies
- Link-State ID: Designated Router's interface IP address
    - Advertising Router: Designated Router ID
    - Network mask: Network mask of the segment
    - Routers attached to the segment

### LSA 3: Network Summary

- Describes reachability to links in other areas (inter-area routing)
- Generated by the ABR
- Flooded from area 0 to non-backbone areas and vice-versa.
- Includes the cost but hides the topology information
    - There is no need to run SPF if this SLA changes. The cost to the ABR doesn't change.
- SPF is not run for ABR advertised routes.
    - This is why inter-area routing is considered Distance Vector.
- Link-State ID: Summary network number
    - Advertising Router: ABR
    - Network Mask
    - Metric

### LSA 4: ASBR Summary LSA

- Describes reachability to the ASBR in other areas
- Generated by ABR
- Flooded from area 0 to non-backbone areas and vice-versa
- Includes cost but hides topology information
    - There is no need to run SPF if this SLA changes. The cost to the ABR doesn't change.
- SPF is not run for ASBR.
    - This is why inter-area external routing is also considered Distance Vector
- Link-State ID: ASBR ID
    - Advertising Router: ABR
    - Metric

### LSA 5: External LSA

- Describe routes ASBR is redistributing
- Generated by ASBR
- Flooded to all non-stub areas
- Metric Type:
    - Type E1 (Take ASBR's cost plus the cost to the ASBR)
        - Prefered over E2
    - Type E2 (Take ASBR's cost)
- Forward Address is used to tell what router should be used to reach a link, usually 0.0.0.0 (the ASBR) itself
- Route Tags

### LSA 6: Multicast LSA

- Implemented by handful of vendors

### LSA 7: NSSA External LSA

- Describe routes ASBR from a NSSA is redistributing
- Generated by an ASBR in a NSSA
- Changed into Type 5 by an ABR as it leaves the area and flooded to all the non-stub areas
- Metric Type:
    - Type N1 (Take ASBR's cost plus the cost to the ASBR)
        - Prefered over N2
    - Type N2 (Take ASBR's cost)
- Forward Address is used to tell what router should be used to reach a link, usually set to one IP address of the ASBR. Set in NSSA.
- Route Tags

### LSA translation quirks

- Translating from LSA 7 to LSA 5 (from a NSSA to Area 0)
    - Just one ABR will perform the translation (router with higher router-id by default)
    - Forwarding Address will be set to the IP address of the router advertising the LSA 7. 
    - It is possible to cause a black hole if there is no route to the Forwarding Address in the translated LSA 5.
    - The Forward Address should be reachable through the same OSPF process or it won't be installed in the Database.
    - It is possible to remove the forward address from the translated LSA 5 (set to 0.0.0.0) and it will solve the SPT towards the Advertasing Router (the ABR translating the LSA 7 to LSA 5)
    - It is possible to set an arbitrary address in the translated LSA 5
    - There is a bit in the LSA 7 that allows to be translated to LSA 5, it can be set to don't allow the translation.
        - This happens by default with an ABR that is redistributing into Area 0 and the NSSA.

## Cisco commands

show ip ospf database [router|network|summary|...]

